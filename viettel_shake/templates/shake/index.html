{% load rest_framework %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Viettel Shake</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.3/toastr.min.css">
  <script
          src="https://code.jquery.com/jquery-3.4.1.min.js"
          integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
          crossorigin="anonymous"></script>

</head>
<body>
<div class="container-fluid" style="padding-top: 3rem">
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <form class="form-horizontal" id="form-otp"

                {#            onsubmit="sendOtp(e)"#}
                {#            action="{% url 'viettel:viettel-shake-request-login' %}" method="POST" #}
              novalidate>
          {% csrf_token %}
          {% render_form request_login_serializer template_pack='rest_framework/vertical' %}
          <div class="form-group">
            <div class="col-sm-offset-2 col-sm-10">
              <button id="submit-otp"
                      type="button" class="btn btn-default">Send OTP
              </button>
            </div>
          </div>
        </form>
        <form class="form-horizontal"
              id="form-login"
{#              action="{% url 'viettel:viettel-shake-login' %}" method="POST"#}
        >
          {% csrf_token %}
          {% render_form login_serializer template_pack='rest_framework/vertical' %}
          <div class="form-group">
            <div class="col-sm-offset-2 col-sm-10">
              <button type="submit" class="btn btn-default">Login</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>

</body>

<script>
  $("#submit-otp").click(function () {
    toastr.warning('Đang thực hiện!', 'Mã OPT đang được gửi đến điện thoại!');
    let url = "{% url 'viettel:viettel-shake-request-login' %}";

    var $inputs = $('#form-otp :input');
    var values = {};
    $inputs.each(function () {
      values[this.name] = $(this).val();
    });
    $.post(url, values, function (res, status) {
      console.log(res, status);

      if(res.status.code === '00'){
        toastr.success('Đã gửi OTP', 'Nhập mã OTP vào bước tiếp theo!');
        $('#form-login :input[name=user_id]').val(values.user_id);
      }else {
        toastr.error(res.status.message,res.status.description);

      }
    });
  });


</script>

</html>
